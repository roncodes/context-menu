{"version":3,"file":"context-menu.js","sources":["../src/context-menu.js"],"sourcesContent":["import './styles.less';\n\nconst instances = [];\nlet nextId = 0;\n\n// Tiny polyfill for Element.matches() for IE\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n\n// Gets an element's next/previous sibling that matches the given selector\nfunction getSibling(el, selector, direction = 1) {\n  const sibling = direction > 0 ? el.nextElementSibling : el.previousElementSibling;\n  if (!sibling || sibling.matches(selector)) {\n    return sibling;\n  }\n  return getSibling(sibling, selector, direction);\n}\n\n// Fires custom event on given element\nfunction emit(el, type, data = {}) {\n  const event = document.createEvent('Event');\n\n  Object.keys(data).forEach((key) => {\n    event[key] = data[key];\n  });\n\n  event.initEvent(type, true, true);\n  el.dispatchEvent(event);\n}\n\nexport default class ContextMenu {\n  constructor(items, options = {\n    className: '',\n    minimalStyling: false,\n  }) {\n    this.items = items;\n    this.options = options;\n    this.id = nextId++;\n    this.target = null;\n\n    this.create();\n    instances.push(this);\n  }\n\n  // Creates DOM elements, sets up event listeners\n  create() {\n    // Create root <ul>\n    this.menu = document.createElement('ul');\n    this.menu.className = 'ContextMenu';\n    this.menu.setAttribute('data-contextmenu', this.id);\n    this.menu.setAttribute('tabindex', -1);\n    this.menu.addEventListener('keyup', (e) => {\n      switch (e.which) {\n        case 38:\n          this.moveFocus(-1);\n          break;\n        case 40:\n          this.moveFocus(1);\n          break;\n        case 27:\n          this.hide();\n          break;\n        default:\n          // do nothing\n      }\n    });\n\n    if (!this.options.minimalStyling) {\n      this.menu.classList.add('ContextMenu--theme-default');\n    }\n    if (this.options.className) {\n      this.options.className.split(' ').forEach(cls => this.menu.classList.add(cls));\n    }\n\n    // Create <li>'s for each menu item\n    this.items.forEach((item, index) => {\n      const li = document.createElement('li');\n\n      if (!('name' in item)) {\n        // Insert a divider\n        li.className = 'ContextMenu-divider';\n      } else {\n        li.className = 'ContextMenu-item';\n        li.textContent = item.name;\n        li.setAttribute('data-contextmenuitem', index);\n        li.setAttribute('tabindex', 0);\n        li.addEventListener('click', this.select.bind(this, li));\n        li.addEventListener('keyup', (e) => {\n          if (e.which === 13) {\n            this.select(li);\n          }\n        });\n      }\n\n      this.menu.appendChild(li);\n    });\n\n    // Add root element to the <body>\n    document.body.appendChild(this.menu);\n\n    emit(this.menu, 'created');\n  }\n\n  // Shows context menu\n  show(e) {\n    this.menu.style.left = `${e.pageX}px`;\n    this.menu.style.top = `${e.pageY}px`;\n    this.menu.classList.add('is-open');\n    this.target = e.target;\n    // Give context menu focus\n    this.menu.focus();\n    // Disable native context menu\n    e.preventDefault();\n\n    emit(this.menu, 'shown');\n  }\n\n  // Hides context menu\n  hide() {\n    this.menu.classList.remove('is-open');\n    this.target = null;\n    emit(this.menu, 'hidden');\n  }\n\n  // Selects the given item and calls its handler\n  select(item) {\n    const itemId = item.getAttribute('data-contextmenuitem');\n    if (this.items[itemId]) {\n      // Call item handler with target element as parameter\n      this.items[itemId].fn(this.target);\n    }\n    this.hide();\n    emit(this.menu, 'itemselected');\n  }\n\n  // Moves focus to the next/previous menu item\n  moveFocus(direction = 1) {\n    const focused = this.menu.querySelector('[data-contextmenuitem]:focus');\n    let next;\n\n    if (focused) {\n      next = getSibling(focused, '[data-contextmenuitem]', direction);\n    }\n\n    if (!next) {\n      next = direction > 0\n        ? this.menu.querySelector('[data-contextmenuitem]:first-child')\n        : this.menu.querySelector('[data-contextmenuitem]:last-child');\n    }\n\n    if (next) next.focus();\n  }\n\n  // Convenience method for adding an event listener\n  on(type, fn) {\n    this.menu.addEventListener(type, fn);\n  }\n\n  // Convenience method for removing an event listener\n  off(type, fn) {\n    this.menu.removeEventListener(type, fn);\n  }\n\n  // Removes DOM elements, stop listeners\n  destroy() {\n    this.menu.parentElement.removeChild(this.menu);\n    this.menu = null;\n    instances.splice(instances.indexOf(this), 1);\n  }\n}\n"],"names":["let","const","this"],"mappings":"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"}