{"version":3,"file":"context-menu.js","sources":["../src/context-menu.js"],"sourcesContent":["import './styles.less';\n\nconst instances = [];\nlet nextId = 0;\n\n// Tiny polyfill for Element.matches() for IE\nif (!Element.prototype.matches) {\n  Element.prototype.matches = Element.prototype.msMatchesSelector;\n}\n\n// Gets an element's next/previous sibling that matches the given selector\nfunction getSibling(el, selector, direction = 1) {\n  const sibling = direction > 0 ? el.nextElementSibling : el.previousElementSibling;\n  if (!sibling || sibling.matches(selector)) {\n    return sibling;\n  }\n  return getSibling(sibling, selector, direction);\n}\n\n// Fires custom event on given element\nfunction emit(el, type, data = {}) {\n  const event = document.createEvent('Event');\n\n  Object.keys(data).forEach((key) => {\n    event[key] = data[key];\n  });\n\n  event.initEvent(type, true, true);\n  el.dispatchEvent(event);\n}\n\nexport default class ContextMenu {\n  constructor(items, options = {\n    className: '',\n    minimalStyling: false,\n  }) {\n    this.items = items;\n    this.options = options;\n    this.id = nextId++;\n    this.target = null;\n\n    this.create();\n    instances.push(this);\n  }\n\n  // Creates DOM elements, sets up event listeners\n  create() {\n    // Create root <ul>\n    this.menu = document.createElement('ul');\n    this.menu.className = 'ContextMenu';\n    this.menu.setAttribute('data-contextmenu', this.id);\n    this.menu.setAttribute('tabindex', -1);\n    this.menu.addEventListener('keyup', (e) => {\n      switch (e.which) {\n        case 38:\n          this.moveFocus(-1);\n          break;\n        case 40:\n          this.moveFocus(1);\n          break;\n        case 27:\n          this.hide();\n          break;\n        default:\n          // do nothing\n      }\n    });\n\n    if (!this.options.minimalStyling) {\n      this.menu.classList.add('ContextMenu--theme-default');\n    }\n    if (this.options.className) {\n      this.options.className.split(' ').forEach(cls => this.menu.classList.add(cls));\n    }\n\n    // Create <li>'s for each menu item\n    this.items.forEach((item, index) => {\n      const li = document.createElement('li');\n\n      if (!('name' in item)) {\n        // Insert a divider\n        li.className = 'ContextMenu-divider';\n      } else {\n        li.className = 'ContextMenu-item';\n        li.textContent = item.name;\n        li.setAttribute('data-contextmenuitem', index);\n        li.setAttribute('tabindex', 0);\n        li.addEventListener('click', this.select.bind(this, li));\n        li.addEventListener('keyup', (e) => {\n          if (e.which === 13) {\n            this.select(li);\n          }\n        });\n      }\n\n      this.menu.appendChild(li);\n    });\n\n    // Add root element to the <body>\n    document.body.appendChild(this.menu);\n\n    emit(this.menu, 'created');\n  }\n\n  // Shows context menu\n  show(e) {\n    this.menu.style.left = `${e.pageX}px`;\n    this.menu.style.top = `${e.pageY}px`;\n    this.menu.classList.add('is-open');\n    this.target = e.target;\n    // Give context menu focus\n    this.menu.focus();\n    // Disable native context menu\n    e.preventDefault();\n\n    emit(this.menu, 'shown');\n  }\n\n  // Hides context menu\n  hide() {\n    this.menu.classList.remove('is-open');\n    this.target = null;\n    emit(this.menu, 'hidden');\n  }\n\n  // Selects the given item and calls its handler\n  select(item) {\n    const itemId = item.getAttribute('data-contextmenuitem');\n    if (this.items[itemId]) {\n      // Call item handler with target element as parameter\n      this.items[itemId].fn(this.target);\n    }\n    this.hide();\n    emit(this.menu, 'itemselected');\n  }\n\n  // Moves focus to the next/previous menu item\n  moveFocus(direction = 1) {\n    const focused = this.menu.querySelector('[data-contextmenuitem]:focus');\n    let next;\n\n    if (focused) {\n      next = getSibling(focused, '[data-contextmenuitem]', direction);\n    }\n\n    if (!next) {\n      next = direction > 0\n        ? this.menu.querySelector('[data-contextmenuitem]:first-child')\n        : this.menu.querySelector('[data-contextmenuitem]:last-child');\n    }\n\n    if (next) next.focus();\n  }\n\n  // Convenience method for adding an event listener\n  on(type, fn) {\n    this.menu.addEventListener(type, fn);\n  }\n\n  // Convenience method for removing an event listener\n  off(type, fn) {\n    this.menu.removeEventListener(type, fn);\n  }\n\n  // Removes DOM elements, stop listeners\n  destroy() {\n    this.menu.parentElement.removeChild(this.menu);\n    this.menu = null;\n    instances.splice(instances.indexOf(this), 1);\n  }\n}\n"],"names":["emit","el","type","data","const","event","document","createEvent","Object","keys","forEach","key","initEvent","dispatchEvent","Element","prototype","matches","msMatchesSelector","ContextMenu","items","options","className","minimalStyling","this","id","nextId","target","create","menu","createElement","setAttribute","addEventListener","e","which","this$1","moveFocus","hide","classList","add","split","cls","item","index","li","textContent","name","select","bind","appendChild","body","show","style","left","top","focus","preventDefault","remove","itemId","getAttribute","fn","direction","next","focused","querySelector","getSibling","selector","sibling","nextElementSibling","previousElementSibling","on","off","removeEventListener","destroy","parentElement","removeChild"],"mappings":"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"}